import pandas as pd
import openpyxl
import os

excel_path = '/Users/younghong/Documents/Files/Data_Frame.xlsx'
excel_ECRI_Associated_Vul_path = '/Users/younghong/Documents/Files/ECRI_Associated_Vul_Name.xlsx'
#sum_vul_num_path = f'/Users/younghong/Documents/Files/{Acc_num}/Summary_Vulnerability_Name.txt'

def get_dataframe(list_Acc_Num):
    i = 0
    dataframe = []
    for Acc_num in list_Acc_Num:
        list_vul_num = []
        sum_vul_path = f'/Users/younghong/Documents/Files/{Acc_num}/Summary_Vulnerability_Name.txt'
        try:
            with open(sum_vul_path, 'r') as f:
                list_vul_num = f.read().splitlines()
                f.close()

        except:
            pass

        list_vul_num.insert(0, list_Acc_Num[i])
        i = i+1
        dataframe.append(list_vul_num)

    return dataframe

def get_rid_repeated_data(old_df):

    unique_df = []

    for df in old_df:
        new_df = []
        for data in df:
            if data not in new_df:
                new_df.append(data)
        unique_df.append(new_df)

    return unique_df
    #print(unique_df)

def get_col_name(length):
    col_name = []
    for i in range(1, length+1):
        name = f'Associated_Vul_Name {i}'
        col_name.append(name)

    return col_name

def get_index_name(length):
    index_name =[]
    for i in range(1, length+1):
        name = f'Row {i}'
        index_name.append(name)

    return index_name

df1 = pd.read_excel(excel_path)
list_Acc_Num = df1.loc[:,"Accession Number"]

df2 = get_dataframe(list_Acc_Num)

df3 = get_rid_repeated_data(df2)

col_length = len(max(df3, key=len))
col_names = get_col_name(col_length)

index_length = len(df3)
index_names = get_index_name(index_length)

df4 = pd.DataFrame(df3, index=index_names, columns=col_names)
df4.to_excel(excel_ECRI_Associated_Vul_path, sheet_name="ECRI")