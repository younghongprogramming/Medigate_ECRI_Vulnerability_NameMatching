"""""
Writer: Young Hong
Department: LMBME Clinical Engineering, Vancouver, BC, Canada
Data_Last_Updated: March 6, 2023

Project:
Create All vulnerability names associated with the accession number found in ECRI

"""""

## Library Used ##
import pandas as pd
import openpyxl
import os
import os.path
from os import path

## File path ##
txt_file_path = '/Users/younghong/Documents/Files/Original_Acc_Num.txt'


## Functions ##

## Function - list all files in the folder
def find_all_files(list):
    dir_path = f'/Users/younghong/Documents/Files/{list}'
    All_files = os.listdir(dir_path)
    return All_files

## Function - list only all text files in the folder
def find_text_files(list):
    list_text_files = []
    for files in list:
        if '.txt' in files:
            list_text_files.append(files)
        else:
            pass
    return list_text_files

## Function - find only text file with vul name
def filter_text_files(list):
    filter_files =[]
    for files in list:
        if 'Vul_Name' in files:
            filter_files.append(files)
        else:
            pass
    return filter_files

## Function - checks if the file exist
def Check_Existing_Files(file_address):
    check = path.exists(file_address)
    if check:
        return True
    else:
        return False


## Function - get vul name into one text file
def get_vul_name(Acc_Num, list):
    #Vul_num = []
    for file in list:
        Vul_num = []
        dir_path = f'/Users/younghong/Documents/Files/{Acc_Num}/{file}'
        with open(dir_path, 'r', encoding="utf-8") as f:
            Vul_num.append(f.read().splitlines())
            f.close()

        file_path = f'/Users/younghong/Documents/Files/{Acc_Num}/Summary_Vulnerability_Name.txt'
        check = Check_Existing_Files(file_path)

        if check:
            with open(file_path, 'a+') as f:
                for num in Vul_num:
                    for one in num:
                        f.write(one)
                        f.write('\n')
            f.close()
        else:
            with open(file_path, 'w') as f:
                for num in Vul_num:
                    for one in num:
                        f.write(one)
                        f.write('\n')
            f.close()

## Main ##

# Get list of accession number
with open(txt_file_path, 'r') as f:
    list_Acc_Num = f.read().splitlines()
    f.close()

# Find all list of files in the folder
list_files = []
for list in list_Acc_Num:
    list_files.append(find_all_files(list))

# Find all text files from the list of the files
list_text_file = []
for list in list_files:
    list_text_file.append(find_text_files(list))

# Find only text file with vul name listed
filtered_text_file = []
for list in list_text_file:
    filtered_text_file.append(filter_text_files(list))


# Combine all 'filtered' text file into one
i = 0
for list in filtered_text_file:
    Acc_Num = list_Acc_Num[i]
    Summary_Txt_Path = f'/Users/younghong/Documents/Files/{Acc_Num}/Summary_Vulnerability_Name.txt'
    Is_File_There = Check_Existing_Files(Summary_Txt_Path)
    if Is_File_There:
        #print("no need to update")
        pass
    else:
        get_vul_name(list_Acc_Num[i], list)
        #print(list_Acc_Num[i])
        #print("update complete")
    i = i+1
